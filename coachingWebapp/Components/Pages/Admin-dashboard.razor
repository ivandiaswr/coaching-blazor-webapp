@page "/admin-dashboard"
@rendermode InteractiveServer
@inject NavigationManager NavigationManager
@inject IConfiguration Configuration
@inject ILogger<Admin_dashboard> Logger

<h3>Authorize the App</h3>
<p>To allow the app to manage your Google Calendar, please click the button below to grant authorization.</p>

<button @onclick="AuthorizeApp">Authorize</button>

@code {
    private void AuthorizeApp()
    {
        var clientId = Configuration["GoogleCalendar:ClientId"];
        var redirectUri = Configuration["GoogleCalendar:CallbackUrl"];
        var scopes = "https://www.googleapis.com/auth/calendar https://www.googleapis.com/auth/calendar.events";

        var authorizationUrl = $"https://accounts.google.com/o/oauth2/v2/auth?response_type=code" +
                               $"&client_id={clientId}" +
                               $"&redirect_uri={Uri.EscapeDataString(redirectUri)}" +
                               $"&scope={Uri.EscapeDataString(scopes)}" +
                               $"&access_type=offline" +
                               $"&prompt=consent";

        Logger.LogInformation(
            $"https://accounts.google.com/o/oauth2/v2/auth?response_type=code" +
            $"&client_id={clientId}" +
            $"&redirect_uri={Uri.EscapeDataString(redirectUri)}" +
            $"&scope={Uri.EscapeDataString(scopes)}" +
            $"&access_type=offline" +
            $"&prompt=consent"
        );

        NavigationManager.NavigateTo(authorizationUrl, true);
    }
}
